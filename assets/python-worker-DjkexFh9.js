(function(){"use strict";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const A=Symbol("Comlink.proxy"),D=Symbol("Comlink.endpoint"),H=Symbol("Comlink.releaseProxy"),x=Symbol("Comlink.finalizer"),_=Symbol("Comlink.thrown"),M=e=>typeof e=="object"&&e!==null||typeof e=="function",L={canHandle:e=>M(e)&&e[A],serialize(e){const{port1:r,port2:n}=new MessageChannel;return k(e,r),[n,[n]]},deserialize(e){return e.start(),G(e)}},U={canHandle:e=>M(e)&&_ in e,serialize({value:e}){let r;return e instanceof Error?r={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:r={isError:!1,value:e},[r,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},R=new Map([["proxy",L],["throw",U]]);function V(e,r){for(const n of e)if(r===n||n==="*"||n instanceof RegExp&&n.test(r))return!0;return!1}function k(e,r=globalThis,n=["*"]){r.addEventListener("message",function i(s){if(!s||!s.data)return;if(!V(n,s.origin)){console.warn(`Invalid origin '${s.origin}' for comlink proxy`);return}const{id:o,type:a,path:c}=Object.assign({path:[]},s.data),u=(s.data.argumentList||[]).map(h);let t;try{const l=c.slice(0,-1).reduce((d,m)=>d[m],e),f=c.reduce((d,m)=>d[m],e);switch(a){case"GET":t=f;break;case"SET":l[c.slice(-1)[0]]=h(s.data.value),t=!0;break;case"APPLY":t=f.apply(l,u);break;case"CONSTRUCT":{const d=new f(...u);t=J(d)}break;case"ENDPOINT":{const{port1:d,port2:m}=new MessageChannel;k(e,m),t=Y(d,[d])}break;case"RELEASE":t=void 0;break;default:return}}catch(l){t={value:l,[_]:0}}Promise.resolve(t).catch(l=>({value:l,[_]:0})).then(l=>{const[f,d]=S(l);r.postMessage(Object.assign(Object.assign({},f),{id:o}),d),a==="RELEASE"&&(r.removeEventListener("message",i),N(r),x in e&&typeof e[x]=="function"&&e[x]())}).catch(l=>{const[f,d]=S({value:new TypeError("Unserializable return value"),[_]:0});r.postMessage(Object.assign(Object.assign({},f),{id:o}),d)})}),r.start&&r.start()}function W(e){return e.constructor.name==="MessagePort"}function N(e){W(e)&&e.close()}function G(e,r){const n=new Map;return e.addEventListener("message",function(s){const{data:o}=s;if(!o||!o.id)return;const a=n.get(o.id);if(a)try{a(o)}finally{n.delete(o.id)}}),C(e,n,[],r)}function E(e){if(e)throw new Error("Proxy has been released and is not useable")}function T(e){return g(e,new Map,{type:"RELEASE"}).then(()=>{N(e)})}const P=new WeakMap,v="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const r=(P.get(e)||0)-1;P.set(e,r),r===0&&T(e)});function B(e,r){const n=(P.get(r)||0)+1;P.set(r,n),v&&v.register(e,r,e)}function q(e){v&&v.unregister(e)}function C(e,r,n=[],i=function(){}){let s=!1;const o=new Proxy(i,{get(a,c){if(E(s),c===H)return()=>{q(o),T(e),r.clear(),s=!0};if(c==="then"){if(n.length===0)return{then:()=>o};const u=g(e,r,{type:"GET",path:n.map(t=>t.toString())}).then(h);return u.then.bind(u)}return C(e,r,[...n,c])},set(a,c,u){E(s);const[t,l]=S(u);return g(e,r,{type:"SET",path:[...n,c].map(f=>f.toString()),value:t},l).then(h)},apply(a,c,u){E(s);const t=n[n.length-1];if(t===D)return g(e,r,{type:"ENDPOINT"}).then(h);if(t==="bind")return C(e,r,n.slice(0,-1));const[l,f]=F(u);return g(e,r,{type:"APPLY",path:n.map(d=>d.toString()),argumentList:l},f).then(h)},construct(a,c){E(s);const[u,t]=F(c);return g(e,r,{type:"CONSTRUCT",path:n.map(l=>l.toString()),argumentList:u},t).then(h)}});return B(o,e),o}function X(e){return Array.prototype.concat.apply([],e)}function F(e){const r=e.map(S);return[r.map(n=>n[0]),X(r.map(n=>n[1]))]}const O=new WeakMap;function Y(e,r){return O.set(e,r),e}function J(e){return Object.assign(e,{[A]:!0})}function S(e){for(const[r,n]of R)if(n.canHandle(e)){const[i,s]=n.serialize(e);return[{type:"HANDLER",name:r,value:i},s]}return[{type:"RAW",value:e},O.get(e)||[]]}function h(e){switch(e.type){case"HANDLER":return R.get(e.name).deserialize(e.value);case"RAW":return e.value}}function g(e,r,n,i){return new Promise(s=>{const o=$();r.set(o,s),e.start&&e.start(),e.postMessage(Object.assign({id:o},n),i)})}function $(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var I=function(e,r,n,i){function s(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function c(l){try{t(i.next(l))}catch(f){a(f)}}function u(l){try{t(i.throw(l))}catch(f){a(f)}}function t(l){l.done?o(l.value):s(l.value).then(c,u)}t((i=i.apply(e,r||[])).next())})},z=function(e,r){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,s,o,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(t){return function(l){return u([t,l])}}function u(t){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,t[0]&&(n=0)),n;)try{if(i=1,s&&(o=t[0]&2?s.return:t[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,t[1])).done)return o;switch(s=0,o&&(t=[t[0]&2,o.value]),t[0]){case 0:case 1:o=t;break;case 4:return n.label++,{value:t[1],done:!1};case 5:n.label++,s=t[1],t=[0];continue;case 7:t=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(t[0]===6||t[0]===2)){n=0;continue}if(t[0]===3&&(!o||t[1]>o[0]&&t[1]<o[3])){n.label=t[1];break}if(t[0]===6&&n.label<o[1]){n.label=o[1],o=t;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(t);break}o[2]&&n.ops.pop(),n.trys.pop();continue}t=r.call(e,n)}catch(l){t=[6,l],s=0}finally{i=o=0}if(t[0]&5)throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}},K=function(e){var r=typeof Symbol=="function"&&Symbol.iterator,n=r&&e[r],i=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},Q=function(e,r){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var i=n.call(e),s,o=[],a;try{for(;(r===void 0||r-- >0)&&!(s=i.next()).done;)o.push(s.value)}catch(c){a={error:c}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o};importScripts("https://cdn.jsdelivr.net/pyodide/v0.26.2/full/pyodide.js"),self.location.hostname!=="localhost"&&(console.log=function(){},console.error=function(){});var b,Z={getInput:function(e,r){var n=new XMLHttpRequest;return n.open("GET","/react-py-get-input/?id=".concat(e,"&prompt=").concat(encodeURIComponent(r)),!1),n.send(null),n.responseText}},j=function(e){return`
import sys, builtins
import react_py
__prompt_str__ = ""
def get_input(prompt=""):
    global __prompt_str__
    __prompt_str__ = prompt
    print(prompt, end="")
    s = react_py.getInput("`.concat(e,`", prompt)
    print()
    return s
builtins.input = get_input
sys.stdin.readline = lambda: react_py.getInput("`).concat(e,`", __prompt_str__)
`)},ee={init:function(e,r,n,i){return I(this,void 0,void 0,function(){var s,o,a,c,u,t,l,f,d,m,w,y;return z(this,function(p){switch(p.label){case 0:return s=self,[4,self.loadPyodide({stdout:e})];case 1:return s.pyodide=p.sent(),[4,self.pyodide.loadPackage(["pyodide-http"])];case 2:return p.sent(),i&&i[0].length>0?[4,self.pyodide.loadPackage(i[0])]:[3,4];case 3:p.sent(),p.label=4;case 4:return i&&i[1].length>0?[4,self.pyodide.loadPackage(["micropip"])]:[3,7];case 5:return p.sent(),o=self.pyodide.pyimport("micropip"),[4,o.install(i[1])];case 6:p.sent(),p.label=7;case 7:return a=self.crypto.randomUUID(),c=self.pyodide.version,self.pyodide.registerJsModule("react_py",Z),u=`
import sys
import pyodide_http

sys.tracebacklimit = 0

pyodide_http.patch_all()
`,[4,self.pyodide.runPythonAsync(u)];case 8:return p.sent(),n!=="console"?[3,11]:(t=self.pyodide.globals.get("dict")(),l=`
import sys
from pyodide.ffi import to_js
from pyodide.console import PyodideConsole, repr_shorten, BANNER
import __main__
BANNER = "Welcome to the Pyodide terminal emulator üêç\\n" + BANNER
pyconsole = PyodideConsole(__main__.__dict__)
import builtins
async def await_fut(fut):
  res = await fut
  if res is not None:
    builtins._ = res
  return to_js([res], depth=1)
def clear_console():
  pyconsole.buffer = []
`,[4,self.pyodide.runPythonAsync(l,{globals:t})]);case 9:return p.sent(),f=t.get("repr_shorten"),d=t.get("BANNER"),m=t.get("await_fut"),w=t.get("pyconsole"),y=t.get("clear_console"),w.stdout_callback=e,b={reprShorten:f,awaitFut:m,pyconsole:w,clearConsole:y},[4,self.pyodide.runPythonAsync(j(a),{globals:t})];case 10:return p.sent(),r({id:a,version:c,banner:d}),[3,13];case 11:return[4,self.pyodide.runPythonAsync(j(a))];case 12:p.sent(),r({id:a,version:c}),p.label=13;case 13:return[2]}})})},run:function(e,r){return I(this,void 0,void 0,function(){var n,i,s,o,a,c,u,t,l,f,d,m,w;return z(this,function(y){switch(y.label){case 0:return r?[4,self.pyodide.loadPackagesFromImports(e)]:[3,2];case 1:y.sent(),y.label=2;case 2:if(!b)return[3,14];if(!b)throw new Error("Console has not been initialised");if(e===void 0)throw new Error("No code to push");n=void 0,y.label=3;case 3:y.trys.push([3,11,12,13]),i=K(e.split(`
`)),s=i.next(),y.label=4;case 4:if(s.done)return[3,10];o=s.value,a=b.pyconsole.push(o),n=a.syntax_check,c=b.awaitFut(a),y.label=5;case 5:return y.trys.push([5,7,8,9]),[4,c];case 6:return u=Q.apply(void 0,[y.sent(),1]),t=u[0],t instanceof self.pyodide.ffi.PyProxy&&t.destroy(),[3,9];case 7:if(l=y.sent(),l.constructor.name==="PythonError")return f=a.formatted_error||l.message,[2,{state:n,error:f.trimEnd()}];throw l;case 8:return a.destroy(),c.destroy(),[7];case 9:return s=i.next(),[3,4];case 10:return[3,13];case 11:return d=y.sent(),m={error:d},[3,13];case 12:try{s&&!s.done&&(w=i.return)&&w.call(i)}finally{if(m)throw m.error}return[7];case 13:return[2,{state:n}];case 14:return[4,self.pyodide.runPythonAsync(e)];case 15:y.sent(),y.label=16;case 16:return[2]}})})},readFile:function(e){return self.pyodide.FS.readFile(e,{encoding:"utf8"})},writeFile:function(e,r){return self.pyodide.FS.writeFile(e,r,{encoding:"utf8"})},mkdir:function(e){self.pyodide.FS.mkdir(e)},rmdir:function(e){self.pyodide.FS.rmdir(e)}};k(ee)})();
